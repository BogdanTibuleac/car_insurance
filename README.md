# ğŸš— Car Insurance API (Django + Docker)

A modular backend system for managing car insurance data â€” built with **Django REST Framework**, **PostgreSQL**, **Redis**, and **Docker**.  
It provides endpoints for cars, insurance policies, claims, and history tracking, including background scheduling, structured logging, and automated testing.

---

## ğŸ§± Architecture Overview

| Layer | Technology |
|-------|-------------|
| **Backend Framework** | Django 5 + Django REST Framework |
| **Database** | PostgreSQL |
| **Cache / Broker** | Redis |
| **Task Scheduling** | APScheduler |
| **Logging** | structlog (JSON logging in production) |
| **Testing** | pytest + pytest-django + coverage |
| **Containerization** | Docker + Docker Compose |
| **Automation** | PowerShell scripts (`scripts/setup/*.ps1`) |

---

## ğŸ—‚ Project Structure

```

car_insurance_backend/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ accounts/               # User registration (Django built-in User)
â”‚   â”œâ”€â”€ cars/                   # Vehicle management
â”‚   â”œâ”€â”€ claims/                 # Insurance claims endpoints
â”‚   â”œâ”€â”€ policies/               # Policies, validity, and expiry tracking
â”‚   â””â”€â”€ **init**.py
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ scheduler.py            # APScheduler background job (policy expiry)
â”‚   â”œâ”€â”€ management/
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚       â””â”€â”€ seed.py         # Seed DB with factory_boy + Faker mock data
â”‚   â””â”€â”€ apps.py
â”‚
â”œâ”€â”€ car_insurance/
â”‚   â”œâ”€â”€ settings.py             # Django + structlog configuration
â”‚   â”œâ”€â”€ urls.py                 # Global API routing
â”‚   â””â”€â”€ wsgi.py
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ setup/
â”‚   â”‚   â”œâ”€â”€ run.ps1             # Start + build full Docker environment
â”‚   â”‚   â”œâ”€â”€ db.ps1              # Manage migrations / database
â”‚   â”œâ”€â”€ cleanup.ps1             # Remove containers & volumes
â”‚   â”œâ”€â”€ seed.ps1                # Seed mock data via Django command
â”‚   â””â”€â”€ scheduler.ps1           # Run APScheduler manually (optional)
â”‚
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ pytest.ini
â”œâ”€â”€ README.md
â””â”€â”€ .env

````

---

## âš™ï¸ Environment Configuration (`.env`)

```ini
# Security
SECRET_KEY=supersecretkey
DEBUG=True

# Database
POSTGRES_DB=car_insurance
POSTGRES_USER=
POSTGRES_PASSWORD=
POSTGRES_HOST=db
POSTGRES_PORT=5432

# Redis / Cache
REDIS_URL=redis://redis:6379/1

# Time zone
TIME_ZONE=Europe/Bucharest

# Scheduler
SCHEDULER_ENABLED=True

# Logging
ENV=dev
LOG_LEVEL=INFO
````

---

## ğŸ§° Commands

### ğŸ”§ Setup and Run

```powershell
.\scripts\setup\run.ps1
```

Or manually:

```bash
docker compose up --build
```

**Access Django API:**
ğŸ‘‰ [http://localhost:8000](http://localhost:8000)

---

### ğŸ—„ï¸ Database Access

```bash
docker exec -it car_insurance_db psql -U car_admin -d car_insurance
```

Inside psql:

```sql
\dt       -- list tables
SELECT * FROM cars;
```

---

### ğŸ§¾ Logs

View live backend logs:

```bash
docker compose logs -f backend
```

**Logging behavior:**

* In **development (ENV=dev)** â†’ human-readable colored console logs.
* In **production (ENV=prod)** â†’ structured JSON logs (machine-readable, ready for observability tools).

---

### ğŸ§© Django Management Commands

```bash
# Apply migrations
docker compose exec backend python manage.py migrate

# Open Django shell
docker compose exec backend python manage.py shell

# Seed mock data
docker compose exec backend python manage.py seed
```

---

## ğŸ§ª Testing

**Automated Testing:**
Uses `pytest`, `pytest-django`, and `pytest-cov` for integration and coverage tests.
Manual API testing is done with **Postman**.

```bash
# Run all tests
docker compose exec backend pytest -v

# Run tests with coverage
docker compose exec backend pytest --cov=apps --cov-report=term-missing -v
```

---

## ğŸ§° Factories & Seeding

Mock data is generated using **factory_boy** and **Faker**. Seeder script:

```bash
docker compose exec backend python manage.py seed
```
---

## ğŸ–¼ï¸ Application Previews

###  Insurance Policies in PostgreSQL  
A direct SQL view from the **`insurance_policy`** table showing registered policies, start and end dates, and logged expirations.  

![Insurance Policies](media/db_insurance_policies.png)

---

###  JSON Logging (Production Mode)  
Demonstrates **structured logging** via `structlog`, where logs are output in JSON format. 

![JSON Logs](media/json_logs.png)

---

###  Live Development Logs  
Console output in **development mode (`ENV=dev`)**, showcasing real-time API request tracking and system events.  

![Development Logs](media/logs.png)

---

###  Policy Expiry Scheduler  
Logs generated by the **APScheduler background job**, automatically detecting and updating expired policies in the system.  

![Policy Expiry Logs](media/log_policy_expiry.png)

---

